<view class="container">
  <!-- ç™»å½•æç¤º -->
  <view class="login-prompt" wx:if="{{!isLoggedIn}}">
    <view class="prompt-content">
      <view class="prompt-icon">ğŸ”’</view>
      <view class="prompt-text">è¯·å…ˆç™»å½•å†è¿›è¡Œè®¢å•ç¡®è®¤</view>
      <button class="login-btn" bindtap="goToLogin">ç™»å½•</button>
    </view>
  </view>

  <!-- è®¢å•ç¡®è®¤å†…å®¹ -->
  <view class="order-content" wx:else>
    <!-- æ”¶è´§åœ°å€ -->
    <view class="address-section">
      <view class="section-title">æ”¶è´§åœ°å€</view>
      <view class="address-card" bindtap="selectAddress" wx:if="{{selectedAddress}}">
        <view class="address-info">
          <view class="contact-row">
            <text class="contact-name">{{selectedAddress.name}}</text>
            <text class="contact-phone">{{selectedAddress.phone}}</text>
          </view>
          <view class="address-detail">{{selectedAddress.fullAddress}}</view>
        </view>
        <view class="address-arrow">></view>
      </view>
      <view class="add-address" bindtap="addAddress" wx:else>
        <view class="add-icon">+</view>
        <text>æ·»åŠ æ”¶è´§åœ°å€</text>
      </view>
    </view>

    <!-- å•†å“åˆ—è¡¨ -->
    <view class="items-section">
      <view class="section-title">å•†å“æ¸…å•</view>
      <view class="items-list">
        <view class="item-row" wx:for="{{orderItems}}" wx:key="id">
          <image class="item-image" src="{{item.image}}" mode="aspectFill"></image>
          <view class="item-info">
            <view class="item-name">{{item.dishName}}</view>
            <view class="item-desc">{{item.description}}</view>
            <view class="item-bottom">
              <text class="item-price">Â¥{{item.price}}</text>
              <text class="item-quantity">x{{item.quantity}}</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- æ”¯ä»˜æ–¹å¼ -->
    <view class="payment-section">
      <view class="section-title">æ”¯ä»˜æ–¹å¼</view>
      <view class="payment-methods">
        <view class="payment-item {{payMethod === 'wechat' ? 'active' : ''}}" bindtap="selectPayMethod" data-method="wechat">
          <image class="payment-icon" src="/images/common/wechat-pay.png" mode="aspectFit"></image>
          <text class="payment-name">å¾®ä¿¡æ”¯ä»˜</text>
          <image class="payment-radio" src="{{payMethod === 'wechat' ? '/images/common/radio-checked.png' : '/images/common/radio-unchecked.png'}}" mode="aspectFit"></image>
        </view>
        <view class="payment-item {{payMethod === 'alipay' ? 'active' : ''}}" bindtap="selectPayMethod" data-method="alipay">
          <image class="payment-icon" src="/images/common/alipay.png" mode="aspectFit"></image>
          <text class="payment-name">æ”¯ä»˜å®</text>
          <image class="payment-radio" src="{{payMethod === 'alipay' ? '/images/common/radio-checked.png' : '/images/common/radio-unchecked.png'}}" mode="aspectFit"></image>
        </view>
      </view>
    </view>

    <!-- å¤‡æ³¨ -->
    <view class="remark-section">
      <view class="section-title">è®¢å•å¤‡æ³¨</view>
      <textarea class="remark-input" placeholder="å¦‚æœ‰ç‰¹æ®Šè¦æ±‚ï¼Œè¯·åœ¨æ­¤å¤„è¯´æ˜..." maxlength="200" bindinput="onRemarkChange" value="{{remark}}"></textarea>
    </view>

    <!-- ä¼˜æƒ åˆ¸ -->
    <view class="coupon-section">
      <view class="section-title">ä¼˜æƒ åˆ¸</view>
      <view class="coupon-item" bindtap="selectCoupon">
        <text class="coupon-text">{{selectedCoupon ? selectedCoupon.title : 'é€‰æ‹©ä¼˜æƒ åˆ¸'}}</text>
        <view class="coupon-arrow">></view>
      </view>
    </view>

    <!-- è®¢å•é‡‘é¢ -->
    <view class="amount-section">
      <view class="amount-row">
        <text class="amount-label">å•†å“æ€»é¢</text>
        <text class="amount-value">Â¥{{subtotalPrice}}</text>
      </view>
      <view class="amount-row">
        <text class="amount-label">é…é€è´¹</text>
        <text class="amount-value">Â¥{{deliveryFee}}</text>
      </view>
      <view class="amount-row discount" wx:if="{{discountAmount > 0}}">
        <text class="amount-label">ä¼˜æƒ åˆ¸ä¼˜æƒ </text>
        <text class="amount-value">-Â¥{{discountAmount}}</text>
      </view>
      <view class="amount-row total">
        <text class="amount-label">å®ä»˜æ¬¾</text>
        <text class="amount-value">Â¥{{finalPrice}}</text>
      </view>
    </view>

    <!-- æäº¤æŒ‰é’® -->
    <view class="submit-section">
      <view class="submit-btn" bindtap="submitOrder">
        æäº¤è®¢å•
      </view>
    </view>
  </view>
</view>